"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Global_1 = require("./utils/Global");
const LogsManager_1 = require("./framework/manager/LogsManager");
const MainModule_1 = require("./framework/manager/MainModule");
const PackConfigManager_1 = require("./framework/manager/PackConfigManager");
const StatisticsManager_1 = require("./game/sys/manager/StatisticsManager");
const DisplayUtils_1 = require("./framework/utils/DisplayUtils");
const CacheManager_1 = require("./framework/manager/CacheManager");
const StorageCode_1 = require("./game/sys/consts/StorageCode");
const FileUtils_1 = require("./framework/utils/FileUtils");
const EngineExpand_1 = require("./framework/engine/EngineExpand");
const JumpManager_1 = require("./framework/manager/JumpManager");
const JumpConst_1 = require("./game/sys/consts/JumpConst");
const FrameWorkHandle_1 = require("./game/sys/manager/FrameWorkHandle");
const StatisticsCommonConst_1 = require("./framework/consts/StatisticsCommonConst");
const BaseFunc_1 = require("./framework/func/BaseFunc");
const UserInfo_1 = require("./framework/common/UserInfo");
const KariquShareConst_1 = require("./framework/consts/KariquShareConst");
const GameConsts_1 = require("./game/sys/consts/GameConsts");
class Main {
    constructor() {
        BaseFunc_1.default.setCfgExportType(BaseFunc_1.default.exportType_New);
        //初始化全就
        this.initWindowEnv();
        FrameWorkHandle_1.default.init();
        PackConfigManager_1.default.initCfgs();
        UserInfo_1.default.init();
        if (UserInfo_1.default.isSystemIos()) {
            UserInfo_1.default.adMediaType = UserInfo_1.PlatformIdType.adMedia_gdt;
        }
        FileUtils_1.default.initRootCachePath();
        //初始化引擎扩展
        EngineExpand_1.default.initEngineExpand();
        this.checkIsNew();
        UserInfo_1.default.platform.setSystemInfo();
        if (Global_1.default.isNew()) {
            StatisticsManager_1.default.ins.onEvent(StatisticsCommonConst_1.default.NEW_LOADING_1);
        }
        else {
            StatisticsManager_1.default.ins.onEvent(StatisticsCommonConst_1.default.LOADING_1);
        }
        // //@xdtest 上线之后注释
        // var defaultSha1 = "C5:19:61:2D:35:23:34:B5:27:EB:A5:37:B5:CA:27:30:75:65:2C:A4|8D:BC:FB:84:97:06:04:72:21:27:BE:A7:A8:23:20:76:81:D4:63:26"
        // var encodeStr = StringUtils.encodeSign(defaultSha1);
        // var decodeStr = StringUtils.decodeSign(encodeStr)
        // LogsManager.echo("__decodeStr:", encodeStr, decodeStr, decodeStr == defaultSha1) ;
        this.showMainModule();
        if (UserInfo_1.default.isWX() || UserInfo_1.default.isTT()) {
            JumpManager_1.default.setJumpChannel(JumpConst_1.default.JUMP_CHANNEL_KARIQU);
            KariquShareConst_1.default.initKariquUrl(GameConsts_1.default.kariquUrlMap);
            JumpManager_1.default.setKariquList({
                1: {
                    url: GameConsts_1.default.JUMP_KARIQU_REDIRECT_LIST_URL,
                    type: JumpConst_1.default.JUMP_KARIQU_LEFTSIDE,
                },
                2: {
                    url: GameConsts_1.default.JUMP_KARIQU_REDIRECT_LIST_URL,
                    type: JumpConst_1.default.JUMP_KARIQU_BATTLEICON,
                },
                3: {
                    url: GameConsts_1.default.JUMP_KARIQU_REDIRECT_LIST_URL,
                    type: JumpConst_1.default.JUMP_KARIQU_BANNER,
                },
            });
        }
        else {
            JumpManager_1.default.setJumpChannel(JumpConst_1.default.JUMP_CHANNEL_FANTASY);
        }
        DisplayUtils_1.default.adjustLabelPos();
    }
    onResize() {
    }
    onVersionLoaded() {
    }
    onConfigLoaded() {
        //加载IDE指定的场景
        this.showMainModule();
        // GameConfig.startScene && Laya.Scene.open(GameConfig.startScene);
    }
    showMainModule() {
        new MainModule_1.default();
    }
    /**打点-激活数据上传到阿里云 */
    checkIsNew() {
        var isNewStr = StorageCode_1.default.storage_isNewPlayer;
        var isNewSta = CacheManager_1.default.instance.getFileStorageCache(isNewStr);
        var isNew = isNewSta == "0" || !isNewSta;
        StatisticsManager_1.default.isNewPlayer = isNew;
        if (!UserInfo_1.default.isWeb()) {
            LogsManager_1.default.sendActiveToAiCloud(isNew ? 1 : 0);
        }
        CacheManager_1.default.instance.setFileStorageCache(isNewStr, true);
    }
    //初始化全局变量
    initWindowEnv() {
        if (!window["LogsManager"]) {
            window["LogsManager"] = LogsManager_1.default;
        }
        //全局封装一个LogsTools变量, 如果修改了底层源码的地方 全部改用LogsTools,防止因为LogsManager因为被加密导致访问不到
        window["LogsTools"] = LogsManager_1.default;
        if (!window["UserInfo"]) {
            window["UserInfo"] = UserInfo_1.default;
        }
    }
}
//激活启动类
new Main();
//# sourceMappingURL=Main.js.map