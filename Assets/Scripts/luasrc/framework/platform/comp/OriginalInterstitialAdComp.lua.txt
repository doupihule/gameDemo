require("stringutil")
require("framework/platform/comp/OriginalAdBaseComp")
require("game/sys/consts/ChannelConst")
require("framework/common/UserInfo")
require("framework/common/GameSwitch")
require("framework/manager/LogsManager")
require("framework/consts/WindowCommonCfgs")
require("framework/manager/WindowManager")
require("framework/platform/AdVideoManager")

OriginalInterstitialAdComp = class('OriginalInterstitialAdComp',OriginalAdBaseComp)
function OriginalInterstitialAdComp:ctor(...)
  self:superCall('ctor', unpack({...}))
  self.logName = 'original_interstitial';
end

function OriginalInterstitialAdComp.__getters.instance()
  if not OriginalInterstitialAdComp._instance then
    OriginalInterstitialAdComp._instance = OriginalInterstitialAdComp()
  end
  return OriginalInterstitialAdComp._instance
end

function OriginalInterstitialAdComp.__getters:adOriginalIds()
  if not self._adOriginalIds then
    if ChannelConst.getChannelConst(UserInfo.platformId).adOriginalInterstitialIds then
      self._adOriginalIds = String(ChannelConst.getChannelConst(UserInfo.platformId).adOriginalInterstitialIds):split("|")
    end
    if GameSwitch.getSwitchState(GameSwitch.ORIGIN_ID) then
      self._adOriginalIds = String(GameSwitch.getSwitchState(GameSwitch.ORIGIN_ID)):split("|")
    end
  end
  return self._adOriginalIds
end

function OriginalInterstitialAdComp:openOriginalView(params, adList)
  if adList then
    LogsManager.echo("hlx 显示原生广告插屏广告1-----------", adList.adId)
    self:reportShowOriginal(adList.adId)
    WindowManager.OpenUI(WindowCommonCfgs.ORIGINALVIEW, {info=adList, pos=params.pos})
    AdVideoManager.instance:updateInterstitialLimit()
  else
    LogsManager.echo('hlx 原生广告插屏未加载到数据，不显示')
  end
end

function OriginalInterstitialAdComp:showOriginalAdView(onErrorCallback, callbackObj, params)
  if params == nil then
    params={pos=-79}
  end
  self:registerOrigionAdv(function(result, params, adList)
    if result and adList then
      self:openOriginalView(params, adList)
    else
      LogsManager.echo('hlx 原生广告插屏未加载到数据，不显示, 执行失败回调')
      onErrorCallback and onErrorCallback:call(callbackObj)
    end
  end
  , self, params)
end
