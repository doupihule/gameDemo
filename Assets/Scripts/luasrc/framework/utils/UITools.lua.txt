UITools = {};
local tempVec2 = CS.UnityEngine.Vector2(0, 0)
--设置 视图坐标obj是 GameObject对象
function UITools.setUIViewPos(instance, x, y)
    local gameobj = instance.__cobject or instance
    local tansform = gameobj:GetComponent("RectTransform");
    -- tansform.TransformPoint(x,y,0);
    tempVec2.x = x;
    tempVec2.y = y;
    tansform.anchoredPosition = tempVec2
end


--获取view的坐标
function UITools.getUIViewPos(instance)
    local gameobj = instance.__cobject or instance
    local tansform = gameobj:GetComponent("RectTransform");
    return tansform.anchoredPosition
end

local tempScaleVec3 = CS.UnityEngine.Vector3(1, 1, 1)

--设置obj缩放
function UITools.setUIViewScale(instance, sx, sy)
    local gameobj = instance.__cobject or instance
    local tansform = gameobj:GetComponent("RectTransform");
    tempScaleVec3.x = sx;
    tempScaleVec3.y = sy;
    tansform.localScale = tempScaleVec3;
end

function UITools.getUIViewScale(instance)
    local gameobj = instance.__cobject or instance
    local tansform = gameobj:GetComponent("RectTransform");
    return tansform.localScale
end

--设置透明度
function UITools.setViewAlpha(instance,alpha)

end

local tempRotateVec3 = CS.UnityEngine.Vector3(0, 0, 1)
--设置obj旋转 角度
function UITools.setUIViewRotation(instance, r)
    local gameobj = instance.__cobject or instance
    local tansform = gameobj:GetComponent("RectTransform");
    tempRotateVec3.z = r;
    tansform.eulerAngles = tempRotateVec3
end



--添加子对象方法
function UITools.addChild(self, childLuaInstance, index)

    local gameObject = self.__cobject
    if (not gameObject) then
        gameObject = self
    end ;

    local selfTransform = gameObject:GetComponent("RectTransform");
    --如果传递的是 luaobject
    local childTransform
    if (childLuaInstance.__cobject) then
        childTransform = childLuaInstance.__cobject:GetComponent("RectTransform");
    else
        childTransform = childLuaInstance:GetComponent("RectTransform");
    end
    childTransform:SetParent(selfTransform, false)
    --设置parent
    if (index ~= nil and index >= 0) then
        --设置层级
        childTransform:SetSiblingIndex(index)
    else
    end
end

--移除所有子对象
function UITools.removeAllChild  (self)
    local gameObject = self.__cobject
    if (not gameObject) then
        gameObject = self
    end
    local transform = gameObject.transform;
    local childCount = transform.childCount
    for i = childCount, 1, -1 do
        local childTransform = transform:GetChild(i)
        childTransform:SetParent(nil)
    end
end

--获取子对象后最好建一个变量自己存起来.不要频繁调用.  原则上所有的调用c#的接口都不要频繁使用
function UITools.getChildAt (self,index)
    local gameObject = self.__cobject
    if (not gameObject) then
        gameObject = self
    end ;
    local transform = gameObject.transform;
    local childTransform = transform:GetChild(i)
    if(childTransform) then
        return  LuaBaseView.bindOneCObjet(childTransform.gameObject )
    end
    return nil
end

--获取childbyname
function UITools.getChildByName(self,name)
    local gameObject = self.__cobject
    if (not gameObject) then
        gameObject = self
    end
    local transform = gameObject.transform;
    local childTransform = transform:Find(name)
    if(childTransform) then
        return  LuaBaseView.bindOneCObjet(childTransform.gameObject )
    end
    --local childCount = transform.childCount
    --for i = childCount, 1, -1 do
    --    local childTransform = transform:GetChild(i)
    --    if(childTransform.name == name)then
    --        return LuaBaseView.bindOneCObjet(childTransform.gameObject )
    --    end
    --end
    return nil
end


--移除子对象方法
function UITools.removeChild (self, childLuaInstance)
    local childTransform
    if (childLuaInstance.__cobject) then
        childTransform = childLuaInstance.__cobject:GetComponent("RectTransform");
    else
        childTransform = childLuaInstance:GetComponent("RectTransform");
    end
    childTransform:SetParent(nil)
end

--移除自己.和移除子对象一样
function UITools.removeSelf (self)
    UITools.removeChild(self, self)
end


--移除某个位置的子对象
function UITools.removeChildAt (self, index)
    local childView = UITools.getChildAt(self,index);
    if(childView) then
        UITools.removeChild(self,childView);
    end
end



--给一个绑定通用函数
function UITools.bindUIFunc(luaInstance)
    --如果没有绑定__cobject return
    luaInstance.addChild = UITools.addChild
    luaInstance.getChildAt = UITools.getChildAt
    luaInstance.removeChild = UITools.removeChild
    luaInstance.removeChildAt = UITools.removeChildAt
    luaInstance.removeSelf = UITools.removeSelf
    luaInstance.removeChildren = UITools.removeAllChild

    luaInstance.setPos = UITools.setUIViewPos

    --设置旋转
    luaInstance.setRotation = UITools.setUIViewRotation
    --缩放
    luaInstance.setScale = UITools.setUIViewScale
    luaInstance.getScale = UITools.getUIViewScale
    --获取2d坐标 只能用x,y
    luaInstance.get2dPos = UITools.getUIViewPos

end

local uiCtn = class("UI2DCtn");


--创建一个2dui 容器
function UITools.createUICtn()
    local ctn = BaseContainer.new();
    return ctn
end



--创建ui图片
function UITools.createUIImage(url,boundlename)
    local imgCtn = UITools.createUICtn();
    local img =  imgCtn.__cobject:GetComponent("Image");
    img.sprite = ResourceManager.loadSprite(url,boundlename);
    return imgCtn;
end

--创建uilabel
function UITools.createLabel(str)
    local img = UITools.createUICtn();
    return label;
end


return UITools


